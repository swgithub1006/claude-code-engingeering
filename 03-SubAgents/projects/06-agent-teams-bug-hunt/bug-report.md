# Bug Report — ShopStream 电商平台

## 报告日期：2025-01-20

## 症状一：会话丢失（严重性：P1）

**报告者**：多个用户

**描述**：用户登录后，在正常使用过程中偶尔被踢回登录页。没有收到任何错误提示，直接跳转到登录页面。

**规律**：
- 高峰期（10:00-11:00, 14:00-16:00）发生频率更高
- 似乎与用户操作无关——浏览商品、查看订单时都可能发生
- 非高峰期几乎不出现

**影响**：每天约 200-300 次会话丢失，影响约 5% 的活跃用户。

---

## 症状二：API 响应变慢（严重性：P2）

**报告者**：前端团队 + 监控告警

**描述**：`/api/orders` 和 `/api/orders/:id` 端点在高峰期响应时间从 200ms 飙升到 3-5 秒。

**规律**：
- 只影响订单相关端点
- 用户路由（/api/users）不受影响
- 与数据库 CPU 使用率高峰时间吻合

**监控数据**：
```
非高峰期：p95 = 180ms, p99 = 350ms
高峰期：  p95 = 2800ms, p99 = 5200ms
```

---

## 症状三：数据泄漏（严重性：P0）

**报告者**：客服团队

**描述**：极少数用户报告在"我的订单"页面看到了**其他用户的订单信息**。

**规律**：
- 极低频（过去一个月 3 起）
- 3 起案例都发生在高峰期
- 用户刷新页面后恢复正常
- 没有发现任何 SQL 注入或权限绕过的迹象

**影响**：虽然频率低，但属于严重的数据安全事件。

---

## 已尝试的排查

1. ✅ 检查了 JWT token 生成和验证逻辑 —— 看起来正常
2. ✅ 检查了数据库查询的 WHERE 条件 —— 都正确包含 user_id
3. ✅ 检查了 Nginx 日志 —— 没有异常请求
4. ❌ 尚未深入分析 Redis / Session 层
5. ❌ 尚未分析高峰期的连接池状态
6. ❌ 尚未检查缓存层逻辑
